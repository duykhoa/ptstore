<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/google-chart/google-chart.html">

<dom-module id="pt-feature-by-point">
  <template>
    <style is="custom-style">
      google-chart {
        height: 500px;
      }
    </style>

    <h3>FEATURE BY POINT</h3>
    <table border='1' style="border-collapse: collapse">
      <template is="dom-repeat" items="{{rowsData}}" as="row">
        <tr>
          <td>{{row.0}}</td>
          <td>{{row.1}}</td>
        </tr>
      </template>
    </table>

    <google-chart
      type="column"
      options='{{chartOptions}}'
      data="{{rowsData}}"
    ></google-chart>
  </template>

  <script>
    class PtFeatureByPoint extends Polymer.Element {
      static get is() { return "pt-feature-by-point"; }
      static get properties() {
        return {
          stories: {
            type: Array,
          },

          features: {
            type: Array,
            computed: "_featuresOf(stories)",
            observer: "_constructRowData",
            notify: true
          },

          chartOptions: {
            type: Object,
            value: {
              title: "Feature by Point",
              animation: {
                easing: "out",
                duration: 500,
                startup: true
              },
              chartArea: {
                left: 30
              },
              vAxis: {
                format: '0',
                gridlines: { count: -1 },
                minValue: 0
              },
              colors: [ '#3367d6' ],
              fontName: "Roboto Mono"
            }
          }
        };
      }

      _constructRowData(features) {
        let header = ["Point", "Story Count"];
        let rowsData = [header].concat(this._featuresByPoint(features));

        this.set("rowsData", rowsData);
      }

      _featuresByPoint(stories) {
        return _.pairs(
          _.countBy(stories, function(story) {
            return story.estimate;
          })
        );
      }

      _featuresOf(stories) {
        return _.filter(stories, function(st) {
          return st.story_type == "feature";
        });
      }
    }

    window.customElements.define(PtFeatureByPoint.is, PtFeatureByPoint);
  </script>
</dom-module>
