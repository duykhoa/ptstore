<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<dom-module id="pt-story-count">
  <template></template>

  <script>
    class PtStoryCount extends Polymer.Element {
      static get is() { return "pt-story-count"; }
      static get properties() {
        return {
          stories: {
            type: Array,
            observer: "_storiesChanged"
          },

          bugCount: {
            type: Number,
            notify: true
          },

          featureCount: {
            type: Number,
            notify: true
          },

          choreCount: {
            type: Number,
            notify: true
          }
        };
      }

      _storiesChanged(stories) {
        let $this = this;

        this._resetCounter("bugCount", "featureCount", "choreCount");

         _.reduce(stories, function(sum, st) {
          if (st.story_type == "bug") {
            $this.bugCount++;
          } else {
            if (st.story_type == "feature") {
              $this.featureCount++;
            } else {
              if (st.story_type == "chore") {
                $this.choreCount++;
              }
            }
          }
        }, 0);

      }

      _resetCounter(...paths) {
        let $this = this;

        _.each(paths, function(value) {
          $this.set(value, 0);
        })
      }
    }

    window.customElements.define(PtStoryCount.is, PtStoryCount);
  </script>
</dom-module>
